# Финансовое веб-приложение "Зернышко к зернышку"

Веб-приложение для мониторинга финансовых показателей и генерации отчетов, позволяющее пользователям отслеживать свои доходы и расходы, а также получать аналитические отчеты на основе введенных данных.

## Содержание
- [Функциональность](#функциональность)
- [Технический стек](#технический-стек)
- [Архитектура](#архитектура)
- [Установка и запуск](#установка-и-запуск)
- [Использование](#использование)
- [Тестирование](#тестирование)
- [Структура проекта](#структура-проекта)
- [Документация](#документация)
- [Известные проблемы](#известные-проблемы)
- [Планируемые улучшения](#планируемые-улучшения)

## Функциональность

### Основные возможности
- Ввод и управление финансовыми операциями
- Генерация аналитических отчетов и дашбордов
- Фильтрация и поиск транзакций
- Визуализация финансовых показателей
- Экспорт отчетов
- Аутентификация пользователей
- Аудит операций

### Поддерживаемые операции
- Создание новой транзакции
- Редактирование транзакций (с учетом статусов)
- Удаление транзакций (с учетом статусов)
- Просмотр и фильтрация транзакций
- Генерация отчетов и дашбордов
- Экспорт данных

### Фильтры для поиска и отчетов
- По банку отправителя/получателя
- По дате (конкретная дата или диапазон)
- По статусу операции
- По ИНН
- По сумме операции (диапазон)
- По типу операции
- По категории

### Дашборды и отчеты
- Динамика по количеству транзакций (неделя/месяц/квартал/год)
- Динамика по типу транзакции (дебет/кредит)
- Сравнение поступлений и расходов
- Статистика по статусам транзакций
- Статистика по банкам
- Отчеты по категориям

## Технический стек
- Backend: Java (Spring Boot)
- Frontend: HTML/CSS/JavaScript
- База данных: PostgreSQL
- IDE: IntelliJ IDEA
- Аутентификация: JWT
- Визуализация данных: Chart.js
- Логирование: PostgreSQL triggers
- Тестирование: JUnit

## Архитектура
Проект следует трехслойной архитектуре:
1. Презентационный слой (Frontend)
   - HTML/CSS для пользовательского интерфейса
   - JavaScript (main.js) для бизнес-логики
   - CSS (main.css, dashboard.css) для стилизации
   - Chart.js для визуализации данных

2. Бизнес-слой (Backend)
   - RESTful API на Spring Boot
   - Обработка бизнес-логики
   - Валидация данных
   - Генерация отчетов

3. Слой данных (Database)
   - PostgreSQL для хранения данных
   - Триггеры для аудита (logs_and_triggers)
   - SQL скрипты для инициализации (database/)

## Установка и запуск

### Предварительные требования
- Java 17 или выше
- PostgreSQL 12 или выше
- IntelliJ IDEA
- Git
- Современный веб-браузер

### Шаги установки
1. Клонировать репозиторий:
```bash
git clone https://github.com/ChertChill/grain-by-grain.git
cd grain-by-grain
```

2. Настроить базу данных:
   - Откройте менеджер базы данных PostgreSQL
   - Создайте новую базу данных
   - Выполните скрипты из папки `database` в следующем порядке:
     1. `tables-exec.sql` - создание таблиц
     2. `data-insert.sql` - заполнение справочников
     3. `data-test.sql` - генерация тестовых транзакций

3. Настройка проекта в IntelliJ IDEA:
   - Откройте проект в IntelliJ IDEA
   - Откройте файл `DatabaseConnection.java`
   - Укажите параметры подключения к базе данных:
     - URL базы данных
     - Имя пользователя
     - Пароль

4. Запуск приложения:
   - Откройте файл `Main.java`
   - Нажмите кнопку "Run" или используйте сочетание клавиш Shift+F10
   - Приложение запустится на `http://localhost:8080`

## Использование

### Доступ к приложению
1. Через веб-интерфейс:
   - Откройте `index.html` в браузере или перейдите по ссылке на деплой лендинга https://chertchill.github.io/grain-by-grain/
   - Войдите в систему используя учетные данные

2. Через API:
   - Все API endpoints доступны по базовому URL: `http://localhost:7070/api`
   - Для тестирования используйте curl-запросы
   - Все запросы (кроме авторизации) требуют JWT токен в заголовке Authorization: Bearer <token>

### Аутентификация
1. Откройте приложение в браузере
2. Войдите или зарегистрируйтесь через API:
   - POST /api/register - регистрация нового пользователя
     ```json
     {
       "full_name": "Имя пользователя",
       "email": "email@example.com",
       "password": "пароль"
     }
     ```
   - POST /api/login - вход в систему
     ```json
     {
       "email": "email@example.com",
       "password": "пароль"
     }
     ```
3. После успешной аутентификации вы получите JWT токен
4. Проверка токена: GET /api/check_user

### Работа с API
1. Доступные endpoints:

   Аутентификация:
   - POST /api/register - регистрация нового пользователя
   - POST /api/login - вход в систему
   - GET /api/check_user - проверка валидности токена

   Справочники:
   - GET /api/reference_data - получение справочных данных (банки, категории, статусы)

   Транзакции:
   - GET /api/get_transactions - получение списка транзакций с фильтрацией
     - Поддерживает параметры фильтрации в query string
     - При ?generate_report=true возвращает PDF-отчет
   - POST /api/create_transaction - создание новой транзакции
   - PUT /api/update_transaction/{id} - обновление транзакции
   - PUT /api/confirm_transaction/{id} - подтверждение транзакции
   - PUT /api/delete_transaction/{id} - удаление транзакции (изменение статуса)

2. Примеры запросов:
   ```bash
   # Получение списка транзакций
   curl -X GET http://localhost:7070/api/get_transactions \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"

   # Создание транзакции
   curl -X POST http://localhost:7070/api/create_transaction \
     -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "type": 1,
       "amount": 1000,
       "comment": "Тестовая транзакция",
       "status": 1,
       "transactionDate": "2024-03-20T10:00:00",
       "accountNumber": "1234567890",
       "recipientNumber": "0987654321",
       "senderBank": 1,
       "recipientBank": 2,
       "recipientTIN": "12345678901",
       "recipientPhone": "+79001234567",
       "category": 1,
       "legalType": 1
     }'

   # Получение справочных данных
   curl -X GET http://localhost:7070/api/reference_data \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"
   ```

### Работа с транзакциями
1. Создание транзакции:
   - Нажмите "Новая транзакция"
   - Заполните обязательные поля:
     - Тип лица (физическое/юридическое)
     - Дата и время операции
     - Тип транзакции
     - Сумма
     - Банк отправителя/получателя
     - ИНН (для юридических лиц)
     - Категория
     - Телефон (для физических лиц)
   - Нажмите "Сохранить"

2. Редактирование транзакции:
   - Найдите транзакцию через поиск/фильтры
   - Нажмите "Редактировать"
   - Внесите изменения
   - Сохраните

3. Удаление транзакции:
   - Найдите транзакцию
   - Нажмите "Удалить"
   - Подтвердите действие

### Генерация отчетов
1. Выберите тип отчета
2. Укажите период
3. Примените фильтры
4. Добавьте параметр ?generate_report=true к запросу GET /api/get_transactions
5. Экспортируйте отчет (PDF-файл в папке Загрузки)

### Аудит операций
Приложение предоставляет возможность получить сведения о выполнении операций с данными, а также сведения о выполняемых запросах. В базе данных приложения настроены триггеры для обеспечения работы механизма аудита. Логирование HTTP-запросов выдётся в консоль сервера и в таблицу в базе данных. При необходимости таблицы аудита и логи запросов могут быть выгружены в формате CSV по запросу к серверу.  
```bash
# Запрос для выгрузки таблиц аудита и логов
curl -v -X GET http://localhost:8080/api/get_logs \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"tableName":"http_logs"}' -o data.csv
```
- data.csv - имя файла для сохранения запрошенной таблицы  
```json
 {
   "tableName": "Имя_таблицы"
 }
 ```
Для выгрузки доступны три таблицы:
 - **http_logs** логи HTTP-запросов
 - **users_audit** аудит таблицы `users`
 - **transactions_audit** аудит таблицы `transactions` 

## Тестирование

### Тестирование API
1. Через curl:
```bash
# Пример получения списка транзакций
curl -X GET http://localhost:8080/api/transactions \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Подготовка тестовых данных
1. Выполните скрипты из папки `database`:
   ```bash
   psql -U your_user -d your_database -f database/tables-exec.sql
   psql -U your_user -d your_database -f database/data-insert.sql
   psql -U your_user -d your_database -f database/data-test.sql
   ```

### Ручное тестирование
1. Проверка ввода данных:
   - Валидация всех полей формы
   - Проверка маски ввода телефона
   - Валидация ИНН
   - Проверка формата даты

2. Проверка фильтрации:
   - Работа всех фильтров
   - Корректность отображения
   - Экспорт данных

3. Проверка отчетов:
   - Генерация всех типов отчетов
   - Корректность расчетов
   - Экспорт в разные форматы

4. Проверка безопасности:
   - Аутентификация
   - Авторизация
   - Валидация прав доступа

## Структура проекта
```
grain-by-grain/
├── backend/                 # Java backend приложение
│   ├── src/                # Исходный код
│   ├── target/             # Скомпилированные файлы
│   ├── pom.xml             # Maven конфигурация
│   └── .gitignore         # Игнорируемые файлы Git
├── frontend/              # Frontend приложение
│   ├── main.js            # Основной JavaScript файл
│   ├── main.css           # Основные стили
│   ├── dashboard.css      # Стили дашборда
│   └── icons/             # Иконки приложения
├── database/             # SQL скрипты
│   ├── tables-exec.sql   # Создание таблиц
│   ├── data-insert.sql   # Начальные данные
│   ├── data-test.sql     # Тестовые данные
│   └── scripts/          # Дополнительные скрипты
├── logs_and_triggers/    # Логи и триггеры БД
├── index.html            # Главная страница
├── .gitignore          # Игнорируемые файлы Git
└── README.md           # Этот файл
```


## Документация
*[ Досписать с ссылками ]*  

- Сведения по логированию запросов и аудиту БД представлены в [файле](logs_and_triggers/Аудит_БД_и_Integrationlog.pdf)  

## Известные проблемы
*[ Дописать ]*
   - [ ] Отсутствует поддержка смены статусов после подтверждения транзакции
   - [ ] Нет возможности массового импорта транзакций
   - [ ] Ограниченный набор форматов экспорта отчетов

## Планируемые улучшения
*[ Дописать ]*
   - [ ] Расширение форматов экспорта
   - [ ] Улучшение производительности при больших объемах данных
   - [ ] Добавление поддержки мобильных устройств
